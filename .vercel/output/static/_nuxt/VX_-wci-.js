import{_ as Y}from"./0NyI0DM_.js";import{H as X,_ as Z}from"./DL2QIr_O.js";import{e as G,l as C,c as D,k as H,o as f,q as A,a as e,t as v,i as m,b as T,w as I,d as N,f as ee,z as oe,r as F,x as te,A as q,B,j as L,F as U,y as V,g as ae,m as J,n as ie}from"./D_68Zcu-.js";const K=()=>{const l=t=>{if(t.quinzena===1)return!0;if(t.periodo_inicio&&t.periodo_fim){const n=new Date(t.periodo_inicio),c=new Date(t.periodo_fim);return n.getDate()===1&&c.getDate()<=15}return t.tipo?.toLowerCase().includes("adiantamento")||t.referencia?.toLowerCase().includes("adiantamento")},_=t=>l(t)?"adiantamento":"folha_mensal",z=t=>l(t)?"ðŸ’° Adiantamento":"ðŸ“Š Folha Mensal",d=t=>{const n=["01-01","04-21","05-01","09-07","10-12","11-02","11-15","12-25"],c=t.toISOString().slice(5,10);return n.includes(c)},h=t=>{const n=t.getDay();return n===0||n===6},p=t=>!h(t)&&!d(t),g=t=>{const n=new Date(t);for(;!p(n);)n.setDate(n.getDate()-1);return n},b=(t,n)=>{const c=new Date(t,n-1,20);if(p(c)){const u=new Date(c);return u.setDate(u.getDate()-2),p(u)?u:g(u)}else{const u=g(c),i=new Date(u);return i.setDate(i.getDate()-2),p(i)?i:g(i)}};return{isAdiantamento:l,getTipoHolerite:_,getTipoLabel:z,isFeriado:d,isFimDeSemana:h,isDiaUtil:p,obterUltimoDiaUtil:g,calcularDataDisponibilizacaoHolerite20:b,deveEstarDisponivelHolerite20:(t,n)=>{const c=new Date,u=b(t,n);return c>=u},calcularProximasDisponibilizacoes:()=>{const t=new Date,n=[];for(let c=0;c<6;c++){const u=new Date(t.getFullYear(),t.getMonth()+c,1),i=u.getFullYear(),o=u.getMonth()+1;n.push({tipo:"inicio_mes",mes:o,ano:i,dataDisponibilizacao:new Date(i,o-1,1),descricao:`Holerite ${o.toString().padStart(2,"0")}/${i} - 1Âª Quinzena (Manual)`});const a=b(i,o);n.push({tipo:"dia_20",mes:o,ano:i,dataDisponibilizacao:a,descricao:`Holerite ${o.toString().padStart(2,"0")}/${i} - 2Âª Quinzena (AutomÃ¡tico)`})}return n.sort((c,u)=>c.dataDisponibilizacao.getTime()-u.dataDisponibilizacao.getTime())},formatarData:t=>t.toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric"}),formatarDataHora:t=>t.toLocaleString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}),calcularPeriodoQuinzenal:(t,n,c)=>{if(c===1)return{inicio:new Date(t,n-1,1),fim:new Date(t,n-1,15),descricao:`1Âª Quinzena - 01 a 15/${n.toString().padStart(2,"0")}/${t}`};{const u=new Date(t,n,0).getDate();return{inicio:new Date(t,n-1,16),fim:new Date(t,n-1,u),descricao:`2Âª Quinzena - 16 a ${u}/${n.toString().padStart(2,"0")}/${t}`}}},isSalarioQuinzenal:t=>t?.tipo_salario==="quinzenal",calcularValorQuinzenal:t=>t/2}},ne={class:"flex items-start justify-between"},le={class:"flex-1"},se={class:"flex items-center gap-3 mb-3"},re={class:"flex items-center gap-2 mb-1"},de={class:"text-lg font-bold text-gray-800"},ue={class:"flex items-center gap-2 text-sm text-gray-500"},ce={key:0,class:"px-2 py-0.5 bg-blue-100 text-blue-800 rounded-full text-xs font-medium"},me={class:"grid grid-cols-2 md:grid-cols-4 gap-4 mt-4"},ge={class:"text-sm font-semibold text-green-600"},be={class:"text-sm font-semibold text-red-600"},pe={class:"text-lg font-bold text-blue-600"},ve={key:0},fe={class:"text-sm font-medium text-gray-700"},xe={key:0,class:"mt-3 p-3 bg-blue-50 rounded-lg"},De={class:"text-sm text-blue-800"},we={class:"flex flex-col gap-2 ml-4"},ye=G({__name:"HoleriteCard",props:{holerite:{}},emits:["view","download"],setup(l){const _=l,{formatarData:z}=K(),d=C(()=>!0),h=x=>x?.toFixed(2).replace(".",",")||"0,00",p=x=>{const s={Pago:{bg:"bg-green-100",badge:"bg-green-100 text-green-800"},Pendente:{bg:"bg-yellow-100",badge:"bg-yellow-100 text-yellow-800"},Programado:{bg:"bg-blue-100",badge:"bg-blue-100 text-blue-800"},Cancelado:{bg:"bg-red-100",badge:"bg-red-100 text-red-800"}};return s[x||"Pendente"]||s.Pendente},g=C(()=>_.holerite?.quinzena===1||_.holerite?.tipo?.toLowerCase().includes("adiantamento")||_.holerite?.referencia?.toLowerCase().includes("adiantamento")),b=()=>g.value?{card:"bg-gradient-to-br from-orange-50 to-yellow-50 border-orange-200",icon:"bg-gradient-to-br from-orange-400 to-yellow-500 text-white shadow-lg",badge:"bg-gradient-to-r from-orange-500 to-yellow-600 text-white shadow-sm"}:{card:"bg-gradient-to-br from-blue-50 to-indigo-50 border-blue-200",icon:"bg-gradient-to-br from-blue-500 to-indigo-600 text-white shadow-lg",badge:"bg-gradient-to-r from-blue-600 to-indigo-700 text-white shadow-sm"},$=()=>g.value?"ðŸ’°":"ðŸ“Š",w=()=>g.value?"Adiantamento":"Folha Mensal";return(x,s)=>{const S=Y;return l.holerite?(f(),D("div",{key:0,class:A(["border rounded-xl p-6 hover:shadow-lg transition-shadow",b().card])},[e("div",ne,[e("div",le,[e("div",se,[e("div",{class:A(["w-12 h-12 rounded-full flex items-center justify-center text-2xl",b().icon])},v($()),3),e("div",null,[e("div",re,[e("h3",de,v(l.holerite.referencia),1),e("span",{class:A(["px-3 py-1 rounded-full text-xs font-bold uppercase tracking-wide",b().badge])},v(w()),3)]),e("div",ue,[e("span",null,v(l.holerite.competencia),1),l.holerite.quinzena?(f(),D("span",ce,v(l.holerite.quinzena)+"Âª Quinzena ",1)):H("",!0),e("span",{class:A(["px-2 py-0.5 rounded-full text-xs font-medium",p(l.holerite.status).badge])},v(l.holerite.status),3)])])]),e("div",me,[e("div",null,[s[2]||(s[2]=e("div",{class:"text-xs text-gray-500 mb-1"},"Proventos",-1)),e("div",ge," R$ "+v(h(l.holerite.totalProventos)),1)]),e("div",null,[s[3]||(s[3]=e("div",{class:"text-xs text-gray-500 mb-1"},"Descontos",-1)),e("div",be," R$ "+v(h(l.holerite.totalDescontos)),1)]),e("div",null,[s[4]||(s[4]=e("div",{class:"text-xs text-gray-500 mb-1"},"LÃ­quido",-1)),e("div",pe," R$ "+v(h(l.holerite.liquido)),1)]),l.holerite.dataDisponibilizacao?(f(),D("div",ve,[s[5]||(s[5]=e("div",{class:"text-xs text-gray-500 mb-1"},"DisponÃ­vel em",-1)),e("div",fe,v(l.holerite.dataDisponibilizacao?m(z)(l.holerite.dataDisponibilizacao):"N/A"),1)])):H("",!0)]),l.holerite.periodoInicio&&l.holerite.periodoFim?(f(),D("div",xe,[s[6]||(s[6]=e("div",{class:"text-xs text-blue-700 font-medium mb-1"},"ðŸ“… PerÃ­odo de ReferÃªncia",-1)),e("div",De,v(l.holerite.periodoInicio?m(z)(l.holerite.periodoInicio):"N/A")+" atÃ© "+v(l.holerite.periodoFim?m(z)(l.holerite.periodoFim):"N/A"),1)])):H("",!0)]),e("div",we,[T(S,{variant:"primary",size:"sm",onClick:s[0]||(s[0]=k=>x.$emit("view",l.holerite)),disabled:!m(d)},{default:I(()=>[...s[7]||(s[7]=[N(" ðŸ‘ï¸ Visualizar ",-1)])]),_:1},8,["disabled"]),T(S,{variant:"secondary",size:"sm",onClick:s[1]||(s[1]=k=>x.$emit("download",l.holerite)),disabled:!m(d)},{default:I(()=>[...s[8]||(s[8]=[N(" ðŸ“¥ Baixar PDF ",-1)])]),_:1},8,["disabled"])])])],2)):H("",!0)}}}),_e=Object.assign(ye,{__name:"HoleritesHoleriteCard"}),ze={class:"bg-white rounded-xl border border-gray-200 p-6 mb-6"},he={class:"flex flex-col sm:flex-row gap-4"},$e={class:"flex-1"},Fe=["value"],He={class:"flex-1"},Se=["value"],ke={class:"flex-1"},Ae={class:"flex items-end"},Ce={key:0,class:"mb-6 p-4 bg-blue-50 border border-blue-200 rounded-xl"},Te={key:1,class:"text-center py-12"},Pe={key:2,class:"text-center py-12"},Qe={key:3,class:"space-y-4"},Le=G({__name:"holerites",async setup(l){let _,z;const{user:d}=ee();d.value?.tipo==="admin"&&([_,z]=oe(()=>ie("/admin/holerites")),await _,z());const{getTipoHolerite:h}=K(),p=F(""),g=F(""),b=F(""),$=F(null),w=F([]),x=F(!0),s=C(()=>d.value?.tipo_salario==="quinzenal"),S=[{value:"01",label:"Janeiro"},{value:"02",label:"Fevereiro"},{value:"03",label:"MarÃ§o"},{value:"04",label:"Abril"},{value:"05",label:"Maio"},{value:"06",label:"Junho"},{value:"07",label:"Julho"},{value:"08",label:"Agosto"},{value:"09",label:"Setembro"},{value:"10",label:"Outubro"},{value:"11",label:"Novembro"},{value:"12",label:"Dezembro"}],k=[{value:"2026",label:"2026"},{value:"2025",label:"2025"},{value:"2024",label:"2024"}],E=async()=>{x.value=!0;try{if(!d.value&&(console.log("â³ Aguardando user..."),await new Promise(a=>setTimeout(a,500)),!d.value)){console.error("âŒ User nÃ£o disponÃ­vel apÃ³s espera"),w.value=[],x.value=!1;return}const i=d.value?.id;if(console.log("ðŸ” User value:",d.value),console.log("ðŸ” Funcionario ID:",i),!i){console.error("âŒ ID do funcionÃ¡rio nÃ£o encontrado no user"),w.value=[],x.value=!1;return}console.log("ðŸ“¡ Buscando holerites para funcionÃ¡rio:",i);const o=await $fetch("/api/holerites/meus-holerites",{query:{funcionarioId:i}});console.log("ðŸ“¦ Dados recebidos da API:",o),console.log("ðŸ“Š Quantidade de holerites:",o.length),w.value=o.map(a=>{const y=new Date(a.periodo_inicio),r=new Date(a.periodo_fim),R=String(y.getMonth()+1).padStart(2,"0"),j=String(y.getFullYear());let P="Mensal",Q=null,M=`Holerite ${y.toLocaleDateString("pt-BR",{month:"long",year:"numeric"})}`;const O=y.getDate(),W=r.getDate();return O===1&&W<=15?(P="Quinzenal",Q=1,M+=" - 1Âª Quinzena"):O===16&&(P="Quinzenal",Q=2,M+=" - 2Âª Quinzena"),{id:a.id,referencia:M,competencia:`${R}/${j}`,mes:R,ano:j,quinzena:Q,tipo:P,status:a.status||"Pago",salarioBase:a.salario_base||0,bonus:a.bonus||0,totalProventos:a.total_proventos||0,inss:a.inss||0,irrf:a.irrf||0,valeTransporte:a.vale_transporte||0,totalDescontos:a.total_descontos||0,liquido:a.salario_liquido||0,periodoInicio:y,periodoFim:r,dataDisponibilizacao:a.data_pagamento?new Date(a.data_pagamento):null,horas_trabalhadas:a.horas_trabalhadas,horas_extras:a.horas_extras,adicional_noturno:a.adicional_noturno,adicional_periculosidade:a.adicional_periculosidade,adicional_insalubridade:a.adicional_insalubridade,comissoes:a.comissoes,vale_refeicao_desconto:a.vale_refeicao_desconto,plano_saude:a.plano_saude,plano_odontologico:a.plano_odontologico,adiantamento:a.adiantamento,faltas:a.faltas,data_pagamento:a.data_pagamento,observacoes:a.observacoes}}),console.log("âœ… Holerites formatados:",w.value),console.log("ðŸ“Š Total de holerites apÃ³s formataÃ§Ã£o:",w.value.length)}catch(i){console.error("âŒ Erro ao carregar holerites:",i),w.value=[]}finally{x.value=!1}};te(()=>{E()});const t=C(()=>{console.log("ðŸ” Filtrando holerites. Total:",w.value.length),console.log("ðŸ” Filtros ativos:",{mes:p.value,ano:g.value,tipo:b.value});const i=w.value.filter(o=>{if(p.value&&o.mes!==p.value||g.value&&o.ano!==g.value)return!1;if(b.value){const a=h(o);if(b.value==="adiantamento"&&a!=="adiantamento"||b.value==="folha_mensal"&&a!=="folha_mensal")return!1}return!0});return console.log("âœ… Holerites filtrados:",i.length),i}),n=()=>{p.value="",g.value="",b.value=""},c=async i=>{let o="Empresa";try{if(d.value){const a=await $fetch(`/api/funcionarios/${d.value.id}`);if(a.empresa_id){const y=await $fetch(`/api/empresas/${a.empresa_id}`),r=y.data||y;o=r.nome_fantasia||r.nome||"Empresa"}}}catch(a){console.error("Erro ao buscar empresa:",a)}$.value={...i,funcionario:{nome_completo:d.value?.nome||"",cargo:d.value?.cargo||"NÃ£o definido",empresa:o},periodo_inicio:i.periodoInicio,periodo_fim:i.periodoFim,salario_base:i.salarioBase,salario_liquido:i.liquido,total_proventos:i.totalProventos,total_descontos:i.totalDescontos}},u=i=>{window.open(`/api/holerites/${i.id}/pdf`,"_blank")};return(i,o)=>{const a=Y,y=Z;return f(),D("div",null,[e("div",ze,[o[11]||(o[11]=e("h3",{class:"text-lg font-semibold text-gray-900 mb-4"},"ðŸ” Filtrar Holerites",-1)),e("div",he,[e("div",$e,[o[5]||(o[5]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"MÃªs",-1)),q(e("select",{"onUpdate:modelValue":o[0]||(o[0]=r=>L(p)?p.value=r:null),class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},[o[4]||(o[4]=e("option",{value:""},"Todos os meses",-1)),(f(),D(U,null,V(S,r=>e("option",{key:r.value,value:r.value},v(r.label),9,Fe)),64))],512),[[B,m(p)]])]),e("div",He,[o[7]||(o[7]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Ano",-1)),q(e("select",{"onUpdate:modelValue":o[1]||(o[1]=r=>L(g)?g.value=r:null),class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},[o[6]||(o[6]=e("option",{value:""},"Todos os anos",-1)),(f(),D(U,null,V(k,r=>e("option",{key:r.value,value:r.value},v(r.label),9,Se)),64))],512),[[B,m(g)]])]),e("div",ke,[o[9]||(o[9]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Tipo",-1)),q(e("select",{"onUpdate:modelValue":o[2]||(o[2]=r=>L(b)?b.value=r:null),class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},[...o[8]||(o[8]=[e("option",{value:""},"Todos os tipos",-1),e("option",{value:"adiantamento"},"ðŸ’° Adiantamento",-1),e("option",{value:"folha_mensal"},"ðŸ“Š Folha Mensal",-1)])],512),[[B,m(b)]])]),e("div",Ae,[T(a,{variant:"secondary",onClick:n},{default:I(()=>[...o[10]||(o[10]=[N("Limpar",-1)])]),_:1})])])]),m(s)?(f(),D("div",Ce,[...o[12]||(o[12]=[ae('<div class="flex items-start gap-3"><span class="text-2xl">ðŸ¤–</span><div><h3 class="font-semibold text-blue-800 mb-2">Holerites AutomÃ¡ticos</h3><div class="text-sm text-blue-700 space-y-1"><p>â€¢ <strong>2Âª Quinzena:</strong> Disponibilizado automaticamente 2 dias antes do dia 20</p><p>â€¢ <strong>1Âª Quinzena:</strong> Liberado manualmente pelo RH no inÃ­cio do mÃªs</p><p>â€¢ <strong>Fins de semana/Feriados:</strong> Antecipado para o Ãºltimo dia Ãºtil anterior</p></div></div></div>',1)])])):H("",!0),m(d)?m(x)?(f(),D("div",Pe,[...o[14]||(o[14]=[e("div",{class:"inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"},null,-1),e("p",{class:"mt-4 text-gray-600"},"Carregando holerites...",-1)])])):(f(),D("div",Qe,[(f(!0),D(U,null,V(m(t),r=>(f(),J(_e,{key:r.id,holerite:r,onView:c,onDownload:u},null,8,["holerite"]))),128)),m(t).length===0?(f(),J(y,{key:0,title:"Nenhum holerite encontrado",description:"Tente ajustar os filtros ou aguarde a geraÃ§Ã£o do prÃ³ximo holerite."})):H("",!0)])):(f(),D("div",Te,[...o[13]||(o[13]=[e("p",{class:"text-red-600"},"âŒ Erro: UsuÃ¡rio nÃ£o autenticado. FaÃ§a login novamente.",-1)])])),T(X,{holerite:m($),"user-name":m(d)?.nome||"","user-cargo":m(d)?.cargo||"","user-departamento":m(d)?.departamento||"",onClose:o[3]||(o[3]=r=>$.value=null),onDownload:u},null,8,["holerite","user-name","user-cargo","user-departamento"])])}}});export{Le as default};
